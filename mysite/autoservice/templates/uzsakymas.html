{% extends "base.html" %}

{% block title %}Užsakymas{% endblock %}

{% block content %}
{% load static %}
<h2>Info apie užsakymą:</h2>
<hr>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-6 col-sm-12">
      <p><b>ID</b> {{ uzsakymas.car.filled_id }}</p>
      <p><b>Užsakymo data</b>: {{ uzsakymas.date | date:"Y-m-d H:i" }}</p>
      <p><b>Terminas</b>: {{ uzsakymas.due_back | date:"Y-m-d" }}</p>
      <p><b>Automobilis</b>: {{ uzsakymas.car.make }} {{ uzsakymas.car.model }}</p>
      <p><b>Klientas</b>: 
        <span>
          {% if uzsakymas.user.photo %}
          <img src="{{ uzsakymas.user.photo.url }}" class="rounded-circle" 
          style="width: 30px; border:1px solid rgb(0, 0, 0);">
          {% endif %}
        </span>
        {{ uzsakymas.car.client.title }}</p>
      <p><b>Valstybiniai numeriai</b>: {{ uzsakymas.car.license_plate }}</p>
      <p><b>VIN</b>: {{ uzsakymas.car.vin_code }}</p>
      <p><b>Užsakymo suma</b>: &euro;{{ uzsakymas.total | floatformat:2 }}</p>
      <p><b>Užsakymo statusas</b>: 
        <span class="{% if uzsakymas.statusas == 'a' %}text-success
            {% elif uzsakymas.statusas == 'r' %}text-info
            {% elif uzsakymas.statusas == 'n' %}text-warning
            {% elif uzsakymas.statusas == 's' %}text-danger
            {% elif uzsakymas.statusas == 'c' %}text-secondary{% endif %}">
          <u>{{ uzsakymas.get_statusas_display }}</u>
        </span>
      </p>
    </div>
    <div class="col-md-6 col-sm-12 pb-3 ">
      {% include "image.html" with auto=uzsakymas.car%}
    </div>
    {% if uzsakymas.user == user or user.is_staff %}
    <div class="mb-2">
      <a class="btn btn-dark btn-sm mt-1 mb-1" 
      href="{% url 'paslauga_create' uzsakymas.pk %}">Pridėti paslaugą +</a>
      <a class="btn btn-dark btn-sm mt-1 mb-1" 
      href="{% url 'uzsakymas_update' uzsakymas.pk %}">Redaguoti užsakymą</a>
      <a class="btn btn-dark btn-sm mt-1 mb-1" 
      href="{% url 'uzsakymas_delete' uzsakymas.pk %}">Ištrinti užsakymą</a>
    </div>
    {% endif %}
  </div>
</div>
<hr>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Paslauga</th>
      <th>Kaina</th>
      <th>Kiekis</th>
      <th>Suma</th>
      {% if uzsakymas.user == user or user.is_staff %}
      <th></th>
      {% endif %}
    </tr>
  </thead>
    {% for line in uzsakymas.lines.all %}
  <tbody>
    <tr>
      <td>{{ line.paslauga.name | capfirst }}</td>
      <td>&euro;{{ line.paslauga.price | floatformat:2 }}</td>
      <td>{{ line.kiekis }}</td>
      <td>&euro;{{ line.line_sum | floatformat:2 }}</td>
      {% if uzsakymas.user == user or user.is_staff %}
      <td>
      <a class="btn btn-secondary btn-sm mt-1 mb-1" 
      href="{% url 'paslauga_update' line.pk %}">Redaguoti</a>
      <a class="btn btn-danger btn-sm mt-1 mb-1" 
      href="{% url 'paslauga_delete' line.pk %}"><b>X</b></a> 
      </td>
      {% endif %}
    </tr>
    {% endfor %}
    <th colspan="3">Bendra suma:</th>
    <th>&euro;{{ uzsakymas.total | floatformat:2 }}</th>
    {% if uzsakymas.user == user or user.is_staff %}
    <th></th>
    {% endif %}
  </tbody>
</table>

<!-- Reikia prideti komentaru redagavimą ir trynimą -->

<h2>Komentarai</h2>
<hr>
{% for komentaras in uzsakymas.komentaras.all %}
<p>
  {% if komentaras.komentatorius.photo %}
    <img src="{{ komentaras.komentatorius.photo.url }}" class="rounded-circle" 
    style="width: 30px; border:1px solid rgb(0, 0, 0);">
  {% else %}
    <img src="{% static 'img/no-profile.png' %}" class="rounded-circle" 
    style="width: 30px; border:1px solid rgb(0, 0, 0);">
  {% endif %}
  <strong>{{ komentaras.komentatorius }}</strong>, <em>{{ komentaras.sukurta }}</em></p>
<p>{{ komentaras.turinys }}</p>
{% empty %}
<p>Komentarų nėra</p>
{% endfor %}
{% if user.is_authenticated %}
<hr>
<p><b>Įveskite papildomą užsakymo komentarą: </b>
<form method="post" class="mb-2">
  {% csrf_token %}
  {% load crispy_forms_tags %}
  {{ form | crispy }}
  <button type="submit" class="btn btn-success">Pateikti</button>
</form></p>
{% endif %}
{% endblock %}